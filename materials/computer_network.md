## ☁️ Компьютерная сеть

> Некоторые знания в этом разделе взяты из Компьютерных сетей (7-е издание)

Архитектура компьютерной сети:
> К сожалению пока картинка не готова

[//]: # (todo)

### Роли и протоколы каждого слоя

| Слои               | роль                                                                                                 | протокол                                                  |
|--------------------|------------------------------------------------------------------------------------------------------|-----------------------------------------------------------|
| Физический слой    | Передача битов через среду, определение механических и электрических спецификаций (биты)             | RJ45, CLOCK, IEEE802.3 (ретрансляторы, концентраторы)     |
| Слой канала данных | Сборка битов в кадры и доставка от точки к точке (Кадр)                                              | PPP, FR, HDLC, VLAN, MAC (мост, коммутатор)               |
| Сетевой слой       | Ответственность за передачу пакетов данных от источника к стоку и межсетевое взаимодействие (пакеты) | IP, ICMP, ARP, RARP, OSPF, IPX, RIP, IGRP (маршрутизатор) |
| Транспортный слой  | Обеспечение надежной доставки сообщений от конца к концу и восстановление ошибок (Сегмент)           | TCP, UDP, SPX                                             |
| Сеансовый слой     | Установление, управление и завершение сеансов (сеансовая протокольная единица данных SPDU)           | NFS, SQL, NETBIOS, RPC                                    |
| Слой представления | Перевод, шифрование и сжатие данных (Единица данных протокола представления PPDU)                    | JPEG, MPEG, ASII                                          |
| Прикладной слой    | Средство для доступа к среде OSI (Единица данных прикладного протокола APDU)                         | FTP, DNS, Telnet, SMTP, HTTP, WWW, NFS                    |

### Физический уровень

* Единица передаваемых данных: бит
* Система передачи данных: исходная система (источник, отправитель) -> система передачи -> система назначения (приемник,
  пункт назначения)

Каналы:

* Однонаправленный канал (simplex channel): только однонаправленная связь, нет обратной взаимодействия, например,
  вещание
* Двунаправленная альтернативная связь (half-duplex communication): обе стороны связи могут отправлять сообщения, но не
  могут отправлять или получать одновременно
* Двунаправленная одновременная связь (full-duplex communication): обе стороны связи могут отправлять и получать
  информацию одновременно

Технология мультиплексирования каналов:

* Частотное разделение мультиплексирование (FDM, Frequency Division Multiplexing): разные пользователи в разных
  частотных диапазонах, пользователи используют разные ресурсы пропускной способности одновременно
* Временное разделение мультиплексирование (TDM): разные пользователи в разных временных интервалах в том же временном
  периоде, все пользователи занимают ту же пропускную способность в разное время
* Мультиплексирование по длине волны (WDM): частотное разделение мультиплексирование света
* Мультиплексирование по коду (CDM): Разные пользователи используют разные коды и могут использовать ту же частотную
  полосу для связи одновременно

### Уровень канала данных

Основной канал:

* Точечный канал
* Широковещательный канал

#### Точечный канал

* Единица данных: кадр

Три основных вопроса:

* Инкапсуляция: инкапсуляция датаграмм IP на сетевом уровне в кадры, `SOH-часть данных-EOT`
* Прозрачная передача: независимо от символов в части данных, она может быть передана; это может быть решено методом
  заполнения байтов (экранирование символов перед конфликтующими символами)
* Обнаружение ошибок: уменьшение битовой частоты ошибок (BER), широко используется циклическая избыточная проверка (CRC,
  Cyclic Redundancy Check)

Протокол точка-точка:

* Протокол точка-точка: протокол, используемый компьютером пользователя для связи с провайдером интернет-услуг

#### Широковещательный канал

Широковещательная связь:

* Аппаратный адрес (физический адрес, MAC-адрес)
* Одноадресный кадр (один-к-одному): MAC-адрес полученного кадра совпадает с аппаратным адресом этой станции
* Широковещательный кадр (один-к-паре): кадр, отправленный на все станции в локальной сети
* Многоадресный кадр (один-к-многим): кадр, отправленный на некоторые сайты в локальной сети

### Сетевой уровень

* IP (Internet Protocol, Internet Protocol) - это протокол, разработанный для общения компьютерных сетей друг с другом.
* ARP (Address Resolution Protocol, Address Resolution Protocol)
* ICMP (Internet Control Message Protocol, Internet Control Message Protocol)
* IGMP (Internet Group Management Protocol, Internet Group Management Protocol)

#### IP Интернет-протокол

Классификация IP-адресов:

* `IP-адрес ::= (<номер сети>, <номер хоста>)`

| Категория IP-адреса | номер сети                                                                                  | диапазон сети          | номер хоста | диапазон IP-адресов          |
|---------------------|---------------------------------------------------------------------------------------------|------------------------|-------------|------------------------------|
| Класс A             | 8 бит, первый бит фиксирован на 0                                                           | 0 —— 127               | 24 бита     | 1.0.0.0 —— 127.255.255.255   |
| Класс B             | 16 бит, первые два бита фиксированы на 10                                                   | 128.0 —— 191.255       | 16 бит      | 128.0.0.0 —— 191.255.255.255 |
| Класс C             | 24 бита, первые три бита фиксированы на 110                                                 | 192.0.0 —— 223.255.255 | 8 бит       | 192.0.0.0 —— 223.255.255.255 |
| Класс D             | Первые четыре бита фиксированы на 1110, за которыми следует многоадресный адрес             |                        |             |                              |
| Класс E             | Первые пять цифр фиксированы на 11110, последние зарезервированы для будущего использования |                        |             |                              |

Формат датаграммы IP:

![Формат датаграммы IP](https://media.geeksforgeeks.org/wp-content/uploads/20230512140024/Screenshot-(359).png)

#### ICMP Интернет-протокол управления сообщениями

Формат сообщения ICMP:

![Формат сообщения ICMP](https://upload.wikimedia.org/wikipedia/commons/thumb/e/e1/ICMP_header_-_General-en.svg/2560px-ICMP_header_-_General-en.svg.png)

* PING (Packet InterNet Groper) для проверки связности между двумя хостами
* TTL (Time To Live, время жизни) Это поле указывает максимальное количество сегментов сети, которые пакеты IP могут
  проходить, прежде чем они будут отброшены маршрутизатором.

#### Внутренний протокол шлюза

* RIP (Протокол информации о маршрутизации, Routing Information Protocol)
* OSPF (Протокол с наименьшим путем, Open Shortest Path First)

#### Внешний протокол шлюза

* BGP (Протокол граничного шлюза, Border Gateway Protocol)

#### IP многоадресная рассылка

* IGMP (Протокол управления группами в Интернете, Internet Group Management Protocol)
* Протокол многоадресной маршрутизации

#### VPN и NAT

* VPN (Виртуальная частная сеть)
* NAT (Трансляция сетевых адресов, Network Address Translation)

#### Что содержит таблица маршрутизации?

1. ID сети (Network ID): Это ID сети адреса назначения.
2. Маска подсети: используется для определения сети, к которой принадлежит IP
3. Адрес / интерфейс следующего перехода: Это адрес следующей остановки данных на пути, отправленном на адрес
   назначения. Где интерфейс указывает на следующий переход (то есть следующий маршрут). Маршрут в автономной системе (
   AS) должен содержать все подсети в области, а шлюз по умолчанию (ID сети: `0.0.0.0`, Маска сети:` 0.0.0.0`) указывает
   на выход из автономной системы.

В зависимости от приложения и реализации таблица маршрутизации может содержать следующую дополнительную информацию:

1. Стоимость: Это стоимость, необходимая для прохождения пути во время передачи данных.
2. Качество обслуживания для маршрутизации
3. Список входящих / исходящих соединений, которые должны быть отфильтрованы в маршруте

### Транспортный слой

протокол:

* TCP (Протокол управления передачей)
* UDP (Протокол пользовательских датаграмм, User Datagram Protocol)

порт:

| Приложения  | FTP | TELNET | SMTP | DNS | TFTP | HTTP | HTTPS | SNMP |
|-------------|-----|--------|------|-----|------|------|-------|------|
| Номер порта | 21  | 23     | 25   | 53  | 69   | 80   | 443   | 161  |

#### TCP

* TCP (Протокол управления передачей, Transmission Control Protocol) - это ориентированный на соединение, надежный,
  основанный на потоке байтов протокол коммуникации транспортного уровня, а его единицей передачи является сегмент
  сообщения.

Особенность:

* Ориентирован на соединение
* Только точка-точка (один-на-один) связь
* Надежное взаимодействие
* Дуплексная связь
* Ориентирован на поток байтов

Как TCP гарантирует надежную передачу:

* Подтверждение и повторная передача по таймауту
* Разумное фрагментирование и упорядочивание данных
* Управление потоком
* Управление перегрузкой
* Проверка данных

Структура сообщения TCP

![TCP Message](https://raw.githubusercontent.com/huihut/interview/master/images/TCP报文.png)

Заголовок TCP

![TCP header](https://raw.githubusercontent.com/huihut/interview/master/images/TCP首部.png)

TCP: Код управления состоянием (Code, Control Flag), который занимает 6 бит и имеет следующее значение:

* URG: Срочно. Когда `URG = 1`, это указывает, что поле срочного указателя действительно, что означает, что пакет
  является срочным пакетом. Он сообщает системе, что в этом сегменте есть срочные данные, и их следует передать как
  можно скорее (эквивалентно данным с высоким приоритетом), и поле Urgent Pointer на рисунке выше также будет включено.
* ACK: Подтверждение. Поле номера подтверждения действительно только при `ACK = 1`, что означает, что этот пакет
  является пакетом подтверждения. Когда `ACK = 0`, номер подтверждения недействителен.
* PSH: (Функция Push) Если он равен 1, представитель требует, чтобы другая сторона немедленно передала другие
  соответствующие пакеты в буфере, не дожидаясь, пока буфер не заполнится перед отправкой.
* RST: Бит сброса (Reset). Когда `RST = 1`, это указывает, что в TCP-соединении произошла серьезная ошибка (например,
  из-за сбоя хоста или по другим причинам). Вы должны освобод